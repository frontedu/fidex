# Server
server.port=${PORT:8080}
server.address=0.0.0.0

# Startup
spring.main.lazy-initialization=false
spring.jmx.enabled=false
spring.main.banner-mode=off
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# Virtual threads (Java 21). Disabled on Java 17.
spring.threads.virtual.enabled=false

# Actuator
management.endpoints.web.exposure.include=health,info
management.info.env.enabled=true
management.endpoint.health.probes.enabled=true
info.app.name=FIDEX
info.app.description=O jeito descomplicado de recompensar seus clientes.
info.app.version=2.0.0

# Logging
logging.level.root=INFO
logging.level.org.flywaydb.core.internal.database.base.Database=ERROR
spring.output.ansi.enabled=always

# Locale
spring.web.locale-resolver=fixed
spring.web.locale=pt_BR
localdate.format-pt_BR=dd/MM/yyyy
spring.flyway.validate-on-migrate=false

# Datasource (env first, with sane defaults)
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:fidex}}
spring.datasource.username=${DATABASE_USERNAME:${DB_USER:postgres}}
spring.datasource.password=${DATABASE_PASSWORD:${DB_PASSWORD:}}

# HikariCP
spring.datasource.hikari.maximum-pool-size=${DB_POOL_MAX:10}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN:2}
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.data-source-properties.reWriteBatchedInserts=true

# JOOQ
spring.jooq.sql-dialect=postgres

# Thymeleaf
spring.thymeleaf.cache=true

# Cache
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=10000,expireAfterWrite=5m

# AOP logging (disable by default for performance)
app.logging.aspect.enabled=false

# Tomcat tuning
server.tomcat.threads.max=${SERVER_TOMCAT_THREADS_MAX:200}
server.tomcat.threads.min-spare=${SERVER_TOMCAT_THREADS_MIN:20}
server.tomcat.accept-count=${SERVER_TOMCAT_ACCEPT_COUNT:100}
server.tomcat.max-connections=${SERVER_TOMCAT_MAX_CONNECTIONS:8192}
