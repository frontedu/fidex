<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="FIDEX - Acesse sua conta e gerencie seu programa de fidelidade de clientes.">
	<meta property="og:title" content="FIDEX - Login">
	<meta property="og:description"
		content="Sistema de fidelização de clientes. Gerencie pontos, prêmios e recompense seus clientes.">
	<meta property="og:type" content="website">
	<title>Entrar | Fidex</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="stylesheet" type="text/css" href="../static/css/login.css" th:href="@{/css/login.css}" />
	<link rel="shortcut icon" th:href="@{/images/favicon.svg}" />
</head>

<body>

	<!-- Toast Notification -->
	<div id="toast" class="toast" th:if="${erro != null || sucesso != null}">
		<div th:if="${sucesso != null}" class="toast-content toast-success" th:text="${sucesso}"></div>
		<div th:if="${erro != null}" class="toast-content toast-error" th:text="${erro}"></div>
	</div>

	<div class="container">
		<div class="left">
			<a th:href="@{/}">
				<svg width="48" height="48" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
					<rect width="32" height="32" fill="white" />
					<rect x="8.38086" y="17.5237" width="14.4762" height="2.28571" fill="black" />
					<rect x="8.38086" y="12.1904" width="3.80952" height="3.80952" rx="1.90476" fill="black" />
				</svg>
			</a>
			<p class="desc">O jeito descomplicado de recompensar seus clientes.</p>
		</div>
		<div class="right">
			<div class="signup wrapper" style="display: none;">
				<h1 class="heading heading-up">Crie sua conta, é rápido e gratuito!</h1>
				<form th:action="@{/usuarios/cadastrar}" method="post" th:object="${usuario}" class="form">
					<div class="input-group">
						<input type="text" id="name" name="nome" />
						<label for="name">Nome e sobrenome</label>
					</div>
					<div class="input-group">
						<input type="text" id="username-signup" name="nomeUsuario" />
						<label for="username-signup">Nome de usuário</label>
					</div>
					<div class="input-group">
						<input type="email" id="email" name="email" onblur="userValue()" />
						<label for="email">Email</label>
					</div>
					<div class="input-group">
						<input type="password" id="password-signup" name="senha" />
						<label for="password-signup">Senha</label>
						<img th:src="@{/images/eye-open.svg}" alt="Ver senha" class="eye eye-signup" />
						<img th:src="@{/images/eye-close.svg}" alt="Esconder senha" class="close-eye close-eye-signup"
							style="display: none" />
					</div>

					<input name="papeis" value="2" class="form-check-input" hidden>
					<input type="hidden" name="dataNascimento" value="01/01/2000" />


					<input type="submit" value="Criar conta" class="btn button_slide slide_right">

					<p class="bottom-text">
						Já tem uma conta?
						<a href="#" onclick="toggle()">Acesse</a>
					</p>
				</form>

			</div>
			<div class="signin wrapper">
				<h1 class="heading">Olá novamente,
					que bom ter você aqui :)</h1>
				<form th:action="@{/login}" method="post" class="form">
					<div class="input-group">
						<input type="text" id="username-signin" name="username" autofocus="autofocus" />
						<label for="username-signin">Nome de usuário</label>
					</div>
					<div class="input-group">
						<input type="password" name="password" id="password-signin" />
						<label for="password-signin">Senha</label>
					</div>

					<input type="submit" value="Entrar" class="btn button_slide slide_right">

					<p class="bottom-text">
						Não tem uma conta?
						<a href="#" onclick="toggle()">Criar agora</a>
					</p>
				</form>
			</div>

		</div>
	</div>

	<!-- Hidden field for signup toggle and debug -->
	<input type="hidden" id="mostrarCadastro" th:value="${mostrarCadastro != null ? mostrarCadastro : false}" />
	<input type="hidden" id="debugErro" th:value="${debugErro}" />

	<script>
		const inputs = document.querySelectorAll(".input-group input");
		inputs.forEach((input) => {
			input.addEventListener("change", () => {
				console.log(input.value);
				if (input.value) {
					input.classList.add("filled");
				} else {
					input.classList.remove("filled");
				}
			});
		});

		// Password toggle for signup form
		const passwordSignup = document.getElementById("password-signup");
		const eyeSignup = document.querySelector(".eye-signup");
		const closeEyeSignup = document.querySelector(".close-eye-signup");

		if (eyeSignup) {
			eyeSignup.addEventListener("click", () => {
				passwordSignup.setAttribute("type", "text");
				eyeSignup.style.display = "none";
				closeEyeSignup.style.display = "block";
			});
		}

		if (closeEyeSignup) {
			closeEyeSignup.addEventListener("click", () => {
				passwordSignup.setAttribute("type", "password");
				closeEyeSignup.style.display = "none";
				eyeSignup.style.display = "block";
			});
		}

		function toggle() {
			var signInDiv = document.querySelector('.signin');
			var signUpDiv = document.querySelector('.signup');

			if (signInDiv.style.display === 'none') {
				signInDiv.style.display = 'flex';
				signUpDiv.style.display = 'none';
			} else {
				signInDiv.style.display = 'none';
				signUpDiv.style.display = 'flex';
			}
		}

		// Log backend errors if any
		var debugErro = document.getElementById('debugErro');
		if (debugErro && debugErro.value) {
			console.error("Backend Error:", debugErro.value);
		}

		// Auto-show signup form if there was an error during registration
		var mostrarCadastroEl = document.getElementById('mostrarCadastro');
		if (mostrarCadastroEl && mostrarCadastroEl.value === 'true') {
			toggle();
		}

	</script>
</body>

</html>